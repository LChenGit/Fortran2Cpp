SUBROUTINE SIDE2(A_IN, SD_A_IN, NX, BADDATA, MAX_SEARCH_RADIUS, MAX_VALUES_PER_SIDE, IX, POINTS_FOUND, IX_FOUND)
  IMPLICIT NONE
  INTEGER NX, IX, IX_SEARCH, POINTS_FOUND, MAX_SEARCH_RADIUS, MAX_VALUES_PER_SIDE
  INTEGER IX_FOUND(NX) ! Assuming the worst case where all indices could be found
  REAL BADDATA
  REAL A_IN(NX), SD_A_IN(NX)

  POINTS_FOUND=0
  DO IX_SEARCH=IX+1,MIN(IX+MAX_SEARCH_RADIUS,NX)
     IF(A_IN(IX_SEARCH).NE.BADDATA.AND.SD_A_IN(IX_SEARCH).NE.BADDATA)THEN
        POINTS_FOUND=POINTS_FOUND+1
        IX_FOUND(POINTS_FOUND)=IX_SEARCH
        IF(POINTS_FOUND.GE.MAX_VALUES_PER_SIDE)THEN
           RETURN
        ENDIF
     ENDIF
  END DO
END SUBROUTINE SIDE2

PROGRAM TestSide2
  IMPLICIT NONE
  INTEGER, PARAMETER :: NX=5
  REAL, DIMENSION(NX) :: A_IN, SD_A_IN
  INTEGER :: MAX_SEARCH_RADIUS, MAX_VALUES_PER_SIDE, IX, POINTS_FOUND
  REAL :: BADDATA
  INTEGER, DIMENSION(NX) :: IX_FOUND
  INTEGER :: i

  ! Initialize test data
  BADDATA = -999.0
  A_IN = (/BADDATA, 1.0, BADDATA, 2.0, BADDATA/)
  SD_A_IN = A_IN
  MAX_SEARCH_RADIUS = 4
  MAX_VALUES_PER_SIDE = 2
  IX = 1

  ! Run the subroutine
  CALL SIDE2(A_IN, SD_A_IN, NX, BADDATA, MAX_SEARCH_RADIUS, MAX_VALUES_PER_SIDE, IX, POINTS_FOUND, IX_FOUND)
  
  ! Output the results for verification
  PRINT *, "Points found =", POINTS_FOUND
  DO i=1,POINTS_FOUND
    PRINT *, "Index found:", IX_FOUND(i)
  END DO
END PROGRAM TestSide2