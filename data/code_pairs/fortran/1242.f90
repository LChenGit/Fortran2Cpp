! File: ADGRD.f90
SUBROUTINE ADGRDF(NVALS, START, INCR, CELLWT, DATA, GRID, WEIGHT)
  INTEGER :: INCR, J, K, NVALS, OFFSET, START
  REAL :: CELLWT, TOTWT
  REAL, DIMENSION(2*NVALS) :: DATA
  REAL, DIMENSION(START+INCR*(NVALS-1)) :: GRID, WEIGHT
  OFFSET = 0
  DO J = 2, 2*NVALS, 2
      IF (DATA(J) >= 0.0) THEN
          TOTWT = CELLWT * DATA(J)
          K = START + OFFSET
          GRID(K) = GRID(K) + DATA(J-1) * TOTWT
          WEIGHT(K) = WEIGHT(K) + TOTWT
      END IF
      OFFSET = OFFSET + INCR
  END DO
END SUBROUTINE ADGRDF

SUBROUTINE ADGRDD(NVALS, START, INCR, CELLWT, DATA, GRID, WEIGHT)
  INTEGER :: INCR, J, K, NVALS, OFFSET, START
  DOUBLE PRECISION :: CELLWT, TOTWT
  DOUBLE PRECISION, DIMENSION(2*NVALS) :: DATA
  DOUBLE PRECISION, DIMENSION(START+INCR*(NVALS-1)) :: GRID, WEIGHT
  OFFSET = 0
  DO J = 2, 2*NVALS, 2
      IF (DATA(J) >= 0.0D0) THEN
          TOTWT = CELLWT * DATA(J)
          K = START + OFFSET
          GRID(K) = GRID(K) + DATA(J-1) * TOTWT
          WEIGHT(K) = WEIGHT(K) + TOTWT
      END IF
      OFFSET = OFFSET + INCR
  END DO
END SUBROUTINE ADGRDD