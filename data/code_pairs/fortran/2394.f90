! grview.f90
SUBROUTINE GRVIEW (ASPECT, DVIEW0, DVIEW)
    REAL :: ASPECT
    REAL :: DVIEW0(4), DVIEW(4)
    REAL :: OS
    INTEGER, PARAMETER :: KLFT=1, KRGT=2, KBOT=3, KTOP=4

    IF (ASPECT .GE. 1.0) THEN
        DVIEW(KLFT) = DVIEW0(KLFT)
        DVIEW(KRGT) = DVIEW0(KRGT)
    ELSE
        OS = 0.5 * (1.0 - ASPECT) * (DVIEW0(KRGT) - DVIEW0(KLFT))
        DVIEW(KLFT) = DVIEW0(KLFT) + OS
        DVIEW(KRGT) = DVIEW0(KRGT) - OS
    END IF

    IF (ASPECT .LE. 1.0) THEN
        DVIEW(KBOT) = DVIEW0(KBOT)
        DVIEW(KTOP) = DVIEW0(KTOP)
    ELSE
        OS = 0.5 * (1.0 - 1.0/ASPECT) * (DVIEW0(KTOP) - DVIEW0(KBOT))
        DVIEW(KBOT) = DVIEW0(KBOT) + OS
        DVIEW(KTOP) = DVIEW0(KTOP) - OS
    END IF
END SUBROUTINE GRVIEW

PROGRAM TestGRVIEW
    IMPLICIT NONE

    REAL :: ASPECT
    REAL :: DVIEW0(4), DVIEW(4)

    ! Test case 1
    ASPECT = 1.5
    DVIEW0 = (/0.0, 2.0, 0.0, 3.0/)
    CALL GRVIEW(ASPECT, DVIEW0, DVIEW)
    PRINT *, 'DVIEW (Test 1): ', DVIEW

    ! Test case 2
    ASPECT = 0.75
    DVIEW0 = (/1.0, 3.0, 2.0, 4.0/)
    CALL GRVIEW(ASPECT, DVIEW0, DVIEW)
    PRINT *, 'DVIEW (Test 2): ', DVIEW
END PROGRAM TestGRVIEW