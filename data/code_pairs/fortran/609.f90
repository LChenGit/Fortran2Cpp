PROGRAM TestDCOORD
  IMPLICIT NONE
  DOUBLE PRECISION :: A0, B0, AP, BP, A1, B1, A2, B2

  ! Test values
  A0 = 0.1D0
  B0 = 0.2D0
  AP = 0.3D0
  BP = 0.4D0
  A1 = 0.5D0
  B1 = 0.6D0

  CALL DCOORD(A0, B0, AP, BP, A1, B1, A2, B2)

  PRINT *, "Results for A2 and B2:"
  PRINT *, "A2 = ", A2
  PRINT *, "B2 = ", B2

END PROGRAM TestDCOORD

SUBROUTINE DCOORD(A0, B0, AP, BP, A1, B1, A2, B2)
  IMPLICIT NONE
  DOUBLE PRECISION, INTENT(IN) :: A0, B0, AP, BP, A1, B1
  DOUBLE PRECISION, INTENT(OUT) :: A2, B2
  DOUBLE PRECISION :: SB0, CB0, SBP, CBP, SB1, CB1, SB2, CB2, SAA, CAA, CBB, SBB, SA2, CA2, TA2O2

  SB0 = SIN(B0)
  CB0 = COS(B0)
  SBP = SIN(BP)
  CBP = COS(BP)
  SB1 = SIN(B1)
  CB1 = COS(B1)
  SB2 = SBP*SB1 + CBP*CB1*COS(AP-A1)
  CB2 = SQRT(1.D0-SB2**2)
  B2 = ATAN2(SB2, CB2)
  SAA = SIN(AP-A1)*CB1/CB2
  CAA = (SB1-SB2*SBP)/(CB2*CBP)
  CBB = SB0/CBP
  SBB = SIN(AP-A0)*CB0
  SA2 = SAA*CBB-CAA*SBB
  CA2 = CAA*CBB+SAA*SBB
  TA2O2 = 0.0D0
  IF(CA2 <= 0.D0) THEN
    TA2O2 = (1.D0-CA2)/SA2
  ELSE
    TA2O2 = SA2/(1.D0+CA2)
  END IF
  A2 = 2.D0*ATAN(TA2O2)
  IF(A2 < 0.D0) A2 = A2 + 6.2831853071795864D0

END SUBROUTINE DCOORD