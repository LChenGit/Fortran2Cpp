FUNCTION NPREROC(N, NB, IPROC, ISRCPROC, NPROCS) RESULT(NPREROCresult)
    INTEGER, INTENT(IN) :: N, NB, IPROC, ISRCPROC, NPROCS
    INTEGER :: NPREROCresult, EXTRABLKS, MYDIST, NBLOCKS

    MYDIST = MOD(NPROCS + IPROC - ISRCPROC, NPROCS)
    NBLOCKS = N / NB
    NPREROCresult = (NBLOCKS / NPROCS) * NB

    EXTRABLKS = MOD(NBLOCKS, NPROCS)

    IF (MYDIST < EXTRABLKS) THEN
        NPREROCresult = NPREROCresult + NB * (MYDIST + 1)
    ELSE
        NPREROCresult = NPREROCresult + EXTRABLKS * NB + MOD(N, NB)
    END IF
END FUNCTION NPREROC

PROGRAM testNPREROC
    PRINT *, "Test 1: Expected 250, Got ", NPREROC(1000, 10, 1, 0, 4)
    PRINT *, "Test 2: Expected 20, Got ", NPREROC(100, 20, 1, 1, 5)
END PROGRAM testNPREROC