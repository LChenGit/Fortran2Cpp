PROGRAM testNWHSEL
  IMPLICIT NONE
  INTEGER :: result
  INTEGER, DIMENSION(5) :: IPTIMS = (/1, 2, 3, 4, 5/)
  LOGICAL, DIMENSION(5) :: WHOTIM = (/ .TRUE., .FALSE., .TRUE., .FALSE., .TRUE. /)
  INTEGER :: NPTIMS

  INTERFACE
      INTEGER FUNCTION NWHSEL(NPTIMS, IPTIMS, WHOTIM)
          INTEGER, INTENT(IN) :: NPTIMS
          INTEGER, INTENT(IN) :: IPTIMS(*)
          LOGICAL, INTENT(IN) :: WHOTIM(*)
      END FUNCTION NWHSEL
  END INTERFACE

  NPTIMS = 5
  result = NWHSEL(NPTIMS, IPTIMS, WHOTIM)
  PRINT *, "Test 1: Expected 3, Got ", result

  WHOTIM = (/ .FALSE., .FALSE., .FALSE., .FALSE., .FALSE. /)
  result = NWHSEL(NPTIMS, IPTIMS, WHOTIM)
  PRINT *, "Test 2: Expected 0, Got ", result

  WHOTIM = (/ .TRUE., .TRUE., .TRUE., .TRUE., .TRUE. /)
  result = NWHSEL(NPTIMS, IPTIMS, WHOTIM)
  PRINT *, "Test 3: Expected 5, Got ", result

END PROGRAM testNWHSEL

INTEGER FUNCTION NWHSEL(NPTIMS, IPTIMS, WHOTIM)
  INTEGER, INTENT(IN) :: NPTIMS
  INTEGER, INTENT(IN) :: IPTIMS(*)
  LOGICAL, INTENT(IN) :: WHOTIM(*)
  INTEGER :: I

  NWHSEL = 0
  DO I = 1, NPTIMS
     IF (WHOTIM(IPTIMS(I))) THEN
        NWHSEL = NWHSEL + 1
     END IF
  END DO
END FUNCTION NWHSEL